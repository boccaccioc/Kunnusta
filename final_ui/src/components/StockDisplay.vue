<template>
  <div id="holder">
    <h3> {{ data.ticker }} </h3>
    <div class="dataItem"> Last Close Price: ${{ data.price }} </div>
    <div class="dataItem"> Date Updated: {{ data.lastRefreshed }} </div>
    <div class="dataItem"> Time Since Last Update: {{ this.daysSinceUpdated }} days</div>
    <div v-if="moreDetails">
          <b-button @click="showSidebar()"> More Details! </b-button>
    </div>
    <span id="dynamicPrice"> {{ chartPrice }} $</span>
    <TrendChart id="chart"
      :datasets="[
      {
        data: prices, //data.priceHistory,
        //data: [571.3699951171875,572.4000854492188,573.0540161132812,573.2659912109375,573.3499755859375,574.5999755859375,575.0850219726562,575.4033203125,575.239990234375,575.5349731445312,575.3900146484375,575.3900146484375,576.110107421875,575.35400390625,575.219970703125,576.0604858398438,574.7999267578125,573.70751953125,574.0927124023438,575.2103881835938,576.1699829101562,577.1624145507812,576.6500244140625,577.18798828125,576.2100219726562,576.8099975585938,577.6561889648438,577.8499755859375,576.8200073242188,577.3875122070312,577.7590942382812,577.75,577.8099975585938,578.1400146484375,577.969970703125,575.780029296875,575.2999877929688,575.3800048828125,576.405029296875,576.1199951171875,575.8400268554688,574.666015625,574.1749877929688,573.64501953125,574.9608154296875,575.5,576.5700073242188,576.489990234375,575.8800048828125,575.4447021484375,574.5452880859375,574.9849853515625,575.7000122070312,575.2000122070312,575.2899780273438,575.2650146484375,574.8300170898438,573.3599853515625,572.8599853515625,573.3800048828125,573.9349975585938,573.4299926757812,574.219970703125,574.2733764648438,573.0999755859375,573.0800170898438,573.3834838867188,573.2000122070312,572.8900146484375,572.7000122070312,573.489990234375,573.6749877929688,573.8599853515625,574.2440795898438,574.4199829101562,574.6898803710938,574.3400268554688,574.239990234375,573.8200073242188,573.3099975585938,572.75,572.2659912109375,572.14501953125,571.6500244140625,571.875,572.4949951171875,572.7249755859375,572.5599975585938,573.1900024414062,573.5,574.05517578125,573.6099853515625,572.7100219726562,573.0139770507812,573.5277709960938,573.530029296875,572.9500122070312,573.3060302734375,573.0599975585938,573.7000122070312,573.4328002929688,573.4099731445312,573.6298828125,574.1300048828125,574.2999877929688,574.4600219726562,574.510009765625,574.2100219726562,574.1199951171875,574.5,575.0399780273438,575.2899780273438,575.27001953125,575.6950073242188,575.6199951171875,575.4879760742188,575.3499755859375,575.2066040039062,575.0700073242188,575.0999755859375,575.3599853515625,575.260009765625,575.6500244140625,575.1599731445312,575.030029296875,574.9400024414062,574.9099731445312,574.9600219726562,575.0349731445312,575.2000122070312,575.3499145507812,575.27001953125,575.719970703125,575.6900024414062,575.2000122070312,575,574.8200073242188,574.7100219726562,575.219970703125,575.4500122070312,575.1400146484375,575.0800170898438,574.9290771484375,574.969970703125,575,575.010009765625,574.7100219726562,574.8900146484375,574.4398803710938,573.969970703125,574,573.6749877929688,573.4400024414062,573.9000244140625,574.2000122070312,573.9799194335938,574.0499877929688,573.8599853515625,573.6677856445312,573.9500122070312,573.719970703125,573.47998046875,573.5900268554688,573.7202758789062,573.97998046875,574.3300170898438,574.2276000976562,574.093017578125,573.5772094726562,573.614990234375,573.219970703125,572.663818359375,572.47998046875,572.7631225585938,572.75,572.6599731445312,572.659912109375,572.885009765625,572.64501953125,572.6099853515625,572.8099975585938,572.8800048828125,573.02001953125,572.6799926757812,572.8900146484375,572.9749755859375,573.3800048828125,573.7100219726562,573.3300170898438,572.9500122070312,573.260009765625,572.77001953125,572.53271484375,572.6699829101562,572.8599853515625,572.530029296875,572.02587890625,571.5850219726562,571.2877807617188,571.3565063476562,571.5499877929688,572.069580078125,572.0100708007812,572.1500244140625,572.52001953125,572.4199829101562,572.4298706054688,572.3331909179688,572.4124755859375,572.2728271484375,572.60498046875,572.5399780273438,572.5700073242188,572.8200073242188,572.6201171875,572.6699829101562,572.6099853515625,572.5,572.2899780273438,572.27001953125,572.1500244140625,572.533203125,572.2401123046875,572.0167846679688,572.219970703125,572.0850219726562,572.3900146484375,572.68359375,572.5800170898438,572.1900024414062,571.6790161132812,571.3941040039062,571.239990234375,571.4656982421875,571.375,571.5900268554688,571.5900268554688,571.4558715820312,571.52001953125,571.3599853515625,571.9998779296875,572.2000122070312,572.1666259765625,571.8699951171875,572.1900024414062,572.030029296875,572,572.3599853515625,572.3499755859375,571.989990234375,571.6090087890625,571.8099975585938,571.6300048828125,571.4400024414062,571.489990234375,571.219970703125,571.28857421875,571,571.5499877929688,570.989990234375,570.7849731445312,571.0213012695312,570.989990234375,570.864990234375,571.090087890625,571.625,571.4949951171875,571.1199951171875,571.427490234375,571.27001953125,571.4749755859375,571.7999877929688,571.989990234375,572.1199951171875,572.5999755859375,572.5349731445312,572.6699829101562,572.9600219726562,573.0800170898438,572.489990234375,572.52001953125,572.6849975585938,572.77001953125,572.489990234375,572.7000122070312,572.4650268554688,572.5800170898438,572.77001953125,573.0399780273438,573.0650024414062,573.5,573.8400268554688,573.7568969726562,573.8300170898438,573.8200073242188,573.739990234375,573.3900146484375,573.7449951171875,574.0399780273438,574.0800170898438,574.0001220703125,574.0900268554688,573.7620239257812,573.3176879882812,573.3800048828125,573.2000122070312,573.157470703125,573.5,573.4199829101562,573.4484252929688,573.4927978515625,573.9500122070312,574.1649169921875,574.219970703125,574.3699951171875,574.0700073242188,573.7899780273438,573.9600219726562,574.2100219726562,574.3800048828125,574.030029296875,574.0435791015625,574.1099853515625,574.0999755859375,574.0999755859375,574.0330810546875,574.030029296875,574.1749877929688,574.4400024414062,574.4000244140625,574.22998046875,573.8400268554688,573.3300170898438,573.5449829101562,573.6599731445312,573.3599853515625,573.905029296875,573.77001953125,573.6699829101562,573.3400268554688,573.5593872070312,573.47998046875,573.6599731445312,573.5800170898438,573.8699951171875,574.280029296875,573.885009765625,574.2703857421875,574.1099853515625,574.2100219726562,574.458984375,574.260009765625,574.14501953125,573.8400268554688,573.9600219726562,573.8250122070312,574.0349731445312,573.7849731445312,573.5900268554688,573.27197265625,573.1900024414062,572.6500244140625,572.5499877929688,572.2999877929688,572.1199951171875,572.7000122070312,572.4299926757812,572.4000244140625,571.9249877929688,572.094970703125,571.905029296875,571.9600219726562,572.5,572.323486328125,572.3800048828125,572.2650146484375,572.1500244140625,571.5999755859375,570.739990234375,570.875,570.9000244140625,571.4500122070312,571.4450073242188,571.530029296875,571.4337158203125,572.239990234375,571.8099975585938,571.8499755859375,571.739990234375,572.9099731445312],
        smooth: true,
        fill: true,
        className:'chart-curve'
      },
      ]"
      :grid="{
        verticalLines: false,
        horizontalLines: false
      }"
      :labels="{
        xLabels: ['9:30', '12:45', '4:00'],//['9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00'],//XLabels,
        yLabels: 4,
        yLabelsTextFormatter: val => '$' + val.toFixed(2),
      }"
      :interactive="true"
      @mouse-move="updateChartPrice"

      >
    </TrendChart>
    <b-button id="deleteButton" @click="deleteThisStock()"> Delete </b-button>
  </div>
</template>

<script>
export default {
  name: 'StockDisplay',
  props: {
    data: Object,
    moreDetails: {
      type: Boolean,
      default: true,
    }
  },
  data () {
    return {
      chartPrice: this.data.priceHistory[0].toFixed(2)
    };
  },
  methods: {
      // pull up sidebar with this stock's data
      showSidebar() {
          this.$emit('show-sidebar', this.data);
      },
      getPrices() {
        console.log(this.data.priceHistory); //for some reason the api is giving some null values in this array
        let val = this.data.priceHistory.splice(90, 15); // eslint-disable-line
        console.log(val);
        return val;
      },
      updateChartPrice(newPrice){
        this.chartPrice = this.data.priceHistory[newPrice.index].toFixed(2);
      },
      deleteThisStock(){
        this.$emit("delete-stock", this.data.ticker);
      },
  },
  computed: {
      // determines the distance between today and the date the api updated the value in days
    daysSinceUpdated(){
        let numDaysApart = 0;
        const lastDate = this.data.lastRefreshed.split('/'); // it is in format MM-DD-YYYY
        let lastUpdate = new Date(lastDate[2], lastDate[0]-1, lastDate[1]);
        const today = new Date();
        while( today.getDate() !== lastUpdate.getDate()){
            numDaysApart = numDaysApart + 1;
            lastUpdate.setDate(lastUpdate.getDate() + 1);
        }
        return numDaysApart;        
    },
    minPrice(){
      return Math.min.apply(Math, this.data.priceHistory);
    },
    maxPrice(){
      console.log(this.data.priceHistory);
      return Math.max.apply(Math, this.data.priceHistory);
    },
    prices(){
      // console.log(this.data.priceHistory); //for some reason the api is giving some null values in this array
      // let val = this.data.priceHistory.splice(90, 15); // eslint-disable-line
      // console.log(val);
      // return val;
      return this.data.priceHistory.filter(function (el) {
      return el != null;
      });
    },
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
#holder {
    background-color: #f0d1e7;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 5px;
}
#deleteButton{
  background-color: tomato;
  color: whitesmoke;
}
.dataItem{
    padding: 10px;
}
#chart{
  background-color: rgb(232, 228, 245);
}
#dynamicPrice{
  font-size: 16;
  color: rgb(77, 77, 228);
}
h3 {
  background-color: rgb(109, 136, 235);
  width: 50%;
  padding-top: 10px;
  padding-bottom: 10px;
  font-size: 30px;
  margin: auto;
  border-radius: 5px;  
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}

</style>

